
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludo Board</title>
    <link rel="stylesheet" href="ludostyle.css">
</head>
<body>
    <h1 class="heading">-:LUDO BOARD:-</h1>

    <!-- Player and Difficulty Selectors -->
    <div style="text-align:center; margin: 20px;">
        <label for="numPlayers">Number of Players: </label>
        <select id="numPlayers">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
        </select>
        &nbsp;&nbsp;&nbsp;
        <label for="difficulty">Select Difficulty: </label>
        <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
        </select>
    </div>

    <!-- Current Turn -->
    <div id="turnDisplay" style="text-align:center; font-size:20px; margin-bottom:10px;">Current Turn: Player 1</div>

    <div class="game">
        <div class="house green">
            <div class="box">
                <div class="square square-one green"></div>
                <div class="square square-two green"></div>
                <div class="square square-three green"></div>
                <div class="square square-four green"></div>
            </div>
        </div>
        <div class="house yellow" style="right: 0">
            <div class="box">
                <div class="square square-one yellow"></div>
                <div class="square square-two yellow"></div>
                <div class="square square-three yellow"></div>
                <div class="square square-four yellow"></div>
            </div>
        </div>
        <div class="house red" style="bottom: 0">
            <div class="box">
                <div class="square square-one red"></div>
                <div class="square square-two red"></div>
                <div class="square square-three red"></div>
                <div class="square square-four red"></div>
            </div>
        </div>
        <div class="house blue" style="bottom: 0;right: 0">
            <div class="box">
                <div class="square square-one blue"></div>
                <div class="square square-two blue"></div>
                <div class="square square-three blue"></div>
                <div class="square square-four blue"></div>
            </div>
        </div>
    </div>

    <!-- Question & Dice Result Display -->
    <div id="questionBox" style="display:none; text-align:center; margin-top: 20px;"></div>
    <div id="diceResult" style="text-align:center; font-size: 24px; margin-top: 10px;"></div>

    <script>
    let questions = [];
    let startTime;
    let humanPlayerQuestionStartTime;
    let humanPlayerCorrectAnswers = 0;
    let humanPlayerTotalQuestions = 0;
    let currentPlayer = 1;
    let totalPlayers = 2;

    fetch('questions.csv')
        .then(response => response.text())
        .then(csv => {
            const lines = csv.trim().split('\n').slice(1);
            questions = lines.map(line => {
                const [difficulty, question, A, B, C, D, answer] = line.split(',');
                return { difficulty, question, A, B, C, D, answer: answer.trim() };
            });
        });

    function showQuestion() {
        const level = document.getElementById("difficulty").value;
        const filtered = questions.filter(q => q.difficulty === level);
        const q = filtered[Math.floor(Math.random() * filtered.length)];
        const isBot = totalPlayers === 1 && currentPlayer === 2;

        if (isBot) {
            const botQuestionViewTime = new Date().getTime();
            let humanSuccessRate = 0.5; // Default if no questions answered yet
            if (humanPlayerTotalQuestions > 0) {
                humanSuccessRate = humanPlayerCorrectAnswers / humanPlayerTotalQuestions;
            }

            let botCorrectChance;
            if (humanSuccessRate > 0.7) { // Player is doing well, bot gets harder
                botCorrectChance = 0.85;
            } else if (humanSuccessRate < 0.4) { // Player is struggling, bot gets easier
                botCorrectChance = 0.35;
            } else { // Medium difficulty
                botCorrectChance = 0.60;
            }

            let botWillBeCorrect = Math.random() < botCorrectChance;
            let botChoice;
            const choices = ['A', 'B', 'C', 'D'];
            const correctAnswerValue = q.answer; // e.g., 'A'

            if (botWillBeCorrect) {
                botChoice = correctAnswerValue;
            } else {
                // Pick a random wrong answer
                let wrongChoices = choices.filter(c => c !== correctAnswerValue);
                botChoice = wrongChoices[Math.floor(Math.random() * wrongChoices.length)];
            }

            // Bot answers after a random delay (3 to 15 seconds)
            // The time taken will affect bot's dice roll via submitAnswer's logic
            const botThinkingTime = Math.floor(Math.random() * 12000) + 3000;

            setTimeout(() => {
                // 'q.answer' is the actual correct answer key, e.g., 'A', 'B' etc.
                submitAnswer(botChoice, correctAnswerValue, botQuestionViewTime);
            }, botThinkingTime);
            return; // Important to return after setting up the bot's delayed answer
        }

        const box = document.getElementById("questionBox");
        box.innerHTML = `
            <p><strong>${q.question}</strong></p>
            <button onclick="submitAnswer('A', '${q.answer}', humanPlayerQuestionStartTime)">${q.A}</button>
            <button onclick="submitAnswer('B', '${q.answer}', humanPlayerQuestionStartTime)">${q.B}</button>
            <button onclick="submitAnswer('C', '${q.answer}', humanPlayerQuestionStartTime)">${q.C}</button>
            <button onclick="submitAnswer('D', '${q.answer}', humanPlayerQuestionStartTime)">${q.D}</button>
        `;
        box.style.display = 'block';
        humanPlayerQuestionStartTime = new Date().getTime();
    }

    function submitAnswer(choice, correctAnswer, questionStartTime) {
        const timeTaken = (new Date().getTime() - questionStartTime) / 1000;
        const box = document.getElementById("questionBox");
        box.style.display = 'none';

        let diceVal;
        if (choice === correctAnswer && timeTaken <= 15) {
            // Roll 1-6
            diceVal = Math.floor(Math.random() * 6) + 1;
        } else {
            // Roll 1-3
            diceVal = Math.floor(Math.random() * 3) + 1;
        }

        document.getElementById("diceResult").innerText = `Player ${currentPlayer} got: ${diceVal}`;

        // Update stats for human player in single player mode
        // Assumes 'currentPlayer' reflects the player who just answered.
        if (totalPlayers === 1 && currentPlayer === 1) {
            humanPlayerTotalQuestions++;
            if (choice === correctAnswer) {
                humanPlayerCorrectAnswers++;
            }
        }
        nextTurn();
    }

    function nextTurn() {
        const numPlayersSelect = document.getElementById("numPlayers");
        totalPlayers = parseInt(numPlayersSelect.value); // User's selection (1, 2, 3, or 4)

        let effectiveNumPlayersForTurnCycle;
        if (totalPlayers === 1) {
            effectiveNumPlayersForTurnCycle = 2; // P1 (Human), P2 (Bot)
        } else {
            effectiveNumPlayersForTurnCycle = totalPlayers; // P1, P2, P3, P4 (all human)
        }

        currentPlayer++;
        if (currentPlayer > effectiveNumPlayersForTurnCycle) {
            currentPlayer = 1;
        }
        document.getElementById("turnDisplay").innerText = "Current Turn: Player " + currentPlayer;

        // Auto trigger for bot. 'totalPlayers' refers to the user's selection of "1 player".
        // 'currentPlayer' is 2 for the bot in a 1-player game.
        if (totalPlayers === 1 && currentPlayer === 2) {
            setTimeout(showQuestion, 1000);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        document.body.addEventListener('click', function (e) {
            if (e.target.id === 'dice' || e.target.classList.contains('dice')) {
                showQuestion();
            }
        });

        document.getElementById("numPlayers").addEventListener('change', () => {
            totalPlayers = parseInt(document.getElementById("numPlayers").value); // Update global totalPlayers
            currentPlayer = 1; // Reset to player 1
            document.getElementById("turnDisplay").innerText = "Current Turn: Player " + currentPlayer;
            // Optional: Clear any pending bot actions if switching away from a bot turn.
            // For now, this is considered outside immediate scope unless issues arise.
        });
    });
    </script>

</body>
</html>
